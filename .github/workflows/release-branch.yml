name: Release Branch Management

on:
  workflow_call:
    inputs:
      dry-run:
        description: Run in dry-run mode
        type: boolean
        default: false
    secrets:
      APP_ID:
        required: true
      APP_PRIVATE_KEY:
        required: true
      ANTHROPIC_API_KEY:
        required: false
      CLAUDE_REVIEW_PAT:
        required: false
      SAVVYWEB_NPM_AUTH_TOKEN:
        required: false

jobs:
  manage-branch:
    name: Manage Release Branch
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: true

      - name: Setup runtime
        id: runtime
        uses: savvy-web/workflow-runtime-action@main

      - name: Run release
        uses: savvy-web/workflow-release-action@main
        with:
          phase: branch-management
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          claude-review-pat: ${{ secrets.CLAUDE_REVIEW_PAT }}
          dry-run: ${{ inputs.dry-run }}
          custom-registries: |
            https://registry.savvyweb.dev/${{ secrets.SAVVYWEB_NPM_AUTH_TOKEN }}
